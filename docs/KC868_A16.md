# Kincony KC868-A16 - ESP-IDF Integration Notes

## Overview

The Kincony KC868-A16 is an ESP32-based Ethernet I/O controller with 16 relay outputs and 16 opto-isolated inputs provided by PCF8574 I/O expanders. This document summarizes the hardware details used by this OpENer port.

## Hardware Configuration

### Ethernet (LAN8720)

| Signal | GPIO |
| --- | --- |
| MDC | GPIO23 |
| MDIO | GPIO18 |
| TXD0 | GPIO19 |
| TXD1 | GPIO22 |
| TX_EN | GPIO21 |
| RXD0 | GPIO25 |
| RXD1 | GPIO26 |
| RX_DV | GPIO27 |
| REF CLK | GPIO17 |
| PHY addr | 0 |

### I2C

| Signal | GPIO |
| --- | --- |
| SDA | GPIO4 |
| SCL | GPIO5 |

### PCF8574 I/O Expanders

| Role | I2C address | ID |
| --- | --- | --- |
| Inputs X01-X08 | 0x22 | inputs_1_8 |
| Inputs X09-X16 | 0x21 | inputs_9_16 |
| Outputs Y01-Y08 | 0x24 | outputs_1_8 |
| Outputs Y09-Y16 | 0x25 | outputs_9_16 |

### Analog Inputs

The KC868-A16 exposes four analog inputs (A1, A2, A3, A4) mapped to internal
channels (INA1, INA2, INA3, INA4). The board routes INA1 and INA4 through the
4-20 mA front-end and INA2 and INA3 through the 0-5 V front-end. The firmware
samples these on ADC1 with 12-bit resolution and 11 dB attenuation, reporting
raw counts (0-4095).

| Physical Terminal | Internal Channel | Type | GPIO | ADC Channel |
| --- | --- | --- | --- | --- |
| A1 | INA1 | 4-20 mA | GPIO36 | ADC1_CH0 |
| A2 | INA2 | 0-5 V | GPIO34 | ADC1_CH6 |
| A3 | INA3 | 0-5 V | GPIO35 | ADC1_CH7 |
| A4 | INA4 | 4-20 mA | GPIO39 | ADC1_CH3 |

## Input and Output Naming

### Inputs via PCF8574

| Name | Expander | Pin | Inverted |
| --- | --- | --- | --- |
| KC868-A16-X01 | inputs_1_8 | 0 | true |
| KC868-A16-X02 | inputs_1_8 | 1 | true |
| KC868-A16-X03 | inputs_1_8 | 2 | true |
| KC868-A16-X04 | inputs_1_8 | 3 | true |
| KC868-A16-X05 | inputs_1_8 | 4 | true |
| KC868-A16-X06 | inputs_1_8 | 5 | true |
| KC868-A16-X07 | inputs_1_8 | 6 | true |
| KC868-A16-X08 | inputs_1_8 | 7 | true |
| KC868-A16-X09 | inputs_9_16 | 0 | true |
| KC868-A16-X10 | inputs_9_16 | 1 | true |
| KC868-A16-X11 | inputs_9_16 | 2 | true |
| KC868-A16-X12 | inputs_9_16 | 3 | true |
| KC868-A16-X13 | inputs_9_16 | 4 | true |
| KC868-A16-X14 | inputs_9_16 | 5 | true |
| KC868-A16-X15 | inputs_9_16 | 6 | true |
| KC868-A16-X16 | inputs_9_16 | 7 | true |

### Outputs via PCF8574

| Name | Expander | Pin | Inverted |
| --- | --- | --- | --- |
| KC868-A16-Y01 | outputs_1_8 | 0 | true |
| KC868-A16-Y02 | outputs_1_8 | 1 | true |
| KC868-A16-Y03 | outputs_1_8 | 2 | true |
| KC868-A16-Y04 | outputs_1_8 | 3 | true |
| KC868-A16-Y05 | outputs_1_8 | 4 | true |
| KC868-A16-Y06 | outputs_1_8 | 5 | true |
| KC868-A16-Y07 | outputs_1_8 | 6 | true |
| KC868-A16-Y08 | outputs_1_8 | 7 | true |
| KC868-A16-Y09 | outputs_9_16 | 0 | true |
| KC868-A16-Y10 | outputs_9_16 | 1 | true |
| KC868-A16-Y11 | outputs_9_16 | 2 | true |
| KC868-A16-Y12 | outputs_9_16 | 3 | true |
| KC868-A16-Y13 | outputs_9_16 | 4 | true |
| KC868-A16-Y14 | outputs_9_16 | 5 | true |
| KC868-A16-Y15 | outputs_9_16 | 6 | true |
| KC868-A16-Y16 | outputs_9_16 | 7 | true |

### EtherNet/IP Input Assembly Layout

The input assembly (instance 100) now reports 10 bytes:

| Offset | Size | Description |
| --- | --- | --- |
| 0 | 1 | Inputs X01-X08 (bit 0=X01 .. bit 7=X08) |
| 1 | 1 | Inputs X09-X16 (bit 0=X09 .. bit 7=X16) |
| 2 | 2 | Analog A1 (INA1) raw - 4-20mA (little-endian) |
| 4 | 2 | Analog A2 (INA2) raw - 0-5V (little-endian) |
| 6 | 2 | Analog A3 (INA3) raw - 0-5V (little-endian) |
| 8 | 2 | Analog A4 (INA4) raw - 4-20mA (little-endian) |
